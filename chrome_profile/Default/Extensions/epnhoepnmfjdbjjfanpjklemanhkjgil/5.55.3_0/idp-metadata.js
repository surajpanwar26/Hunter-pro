(()=>{var P=Object.create;var b=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var z=(r,e)=>()=>(r&&(e=r(r=0)),e);var D=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var U=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of O(e))!q.call(r,s)&&s!==t&&b(r,s,{get:()=>e[s],enumerable:!(o=N(e,s))||o.enumerable});return r};var j=(r,e,t)=>(t=r!=null?P(V(r)):{},U(e||!r||!r.__esModule?b(t,"default",{value:r,enumerable:!0}):t,r));var n=z(()=>{});var K=D((H,v)=>{n();var _=Array.isArray;v.exports=_});n();n();n();var i=chrome;n();n();var x=j(K()),l=class{executeScript(e,t){let{tabId:o,frameId:s}=e,d={tabId:o,...s&&{frameIds:[s]}},{file:p,func:h,args:w,world:F,injectImmediately:L}=t,S=!!p,I=!!(h||w);if(S&&I)throw new Error("Cannot inject both file and function in one call");let m={target:d,world:F,injectImmediately:L};return S?m.files=[p]:I&&(m.func=h,m.args=w),i.scripting.executeScript(m)}async registerContentScripts(e){if(!(0,x.default)(e))throw new Error("registerContentScripts must be given an array of content scripts to register");return i.scripting.registerContentScripts(e)}async unregisterContentScripts(e){return i.scripting.unregisterContentScripts(e)}},E=new l;var y=class{async getCurrentActiveTab(){let e=await i.tabs.query({active:!0,currentWindow:!0});return e?e[0]:null}getAllActiveTabs(){return i.tabs.query({active:!0})}getAllTabs(){return i.tabs.query({})}async executeScriptOnCurrentTab(e){let t=await this.getCurrentActiveTab();if(t!==null)return E.executeScript({tabId:t.id},e)}addListener(e,t){i.tabs[e].addListener(t)}removeListener(e,t){i.tabs[e].removeListener(t)}remove(e){return i.tabs.remove(e)}openExtensionPage(e){return i.tabs.create({url:e})}},M=new y;var f=class{sendMessage(e,t){let o={...t,type:e};return i.runtime.sendMessage(o)}async sendMessageToCurrentTab(e,t,o){let s={...t,type:e},d=await M.getCurrentActiveTab();return i.tabs.sendMessage(d.id,s,o)}sendMessageToTab(e,t,o,s){let d={...o,type:t};return i.tabs.sendMessage(e,d,s)}addListener(e,t){let o=(s,d,p)=>s.type!==e?!1:(t(s,d,p),!0);return i.runtime.onMessage.addListener(o),()=>i.runtime.onMessage.removeListener(o)}},T=new f;n();n();var u=class{constructor(e={}){let{useManagedStorage:t}=e;if(this.useManagedStorage=!!t,!i.storage){console.error("Do not have storage access in this context");return}t?this.storage=i.storage.managed:this.storage=i.storage.local}async getAllItems(){this.throwErrorIfNoStorage();try{return await this.storage.get(null)}catch(e){if(e.message==="Managed storage manifest not found")return;console.error("Unable to get all items",e)}}async getFromStorage(e){this.throwErrorIfNoStorage();try{return(await this.storage.get(e))[e]}catch(t){if(t.message==="Managed storage manifest not found")return;console.error("Unable to get from storage",t)}}async removeFromStorage(e){this.throwErrorIfNoStorage();try{return await this.storage.remove(e)}catch(t){if(t.message==="Managed storage manifest not found")return;console.error("Unable to remove from storage",t)}}setInStorage(e,t){if(this.throwErrorIfNoStorage(),this.useManagedStorage)throw new Error("Cannot set items in managed storage");let o={[e]:t};return this.storage.set(o)}throwErrorIfNoStorage(){if(!this.storage)throw new Error("Storage is not available in this context")}addOnChangedListener(e){this.storage.onChanged.addListener(e)}removeOnChangedListener(e){this.storage.onChanged.removeListener(e)}},g=new u,A=new u({useManagedStorage:!0});n();var a={account:"account",additionalApiKeys:"additionalAPIKeys",agentSettings:"agentSettings",applications:"applications",discoveryApplications:"discoveryApplications",authWindowInfo:"authWindowInfo",configFetchedTimestamp:"configFetchedTimestamp",dataEnvironment:"dataEnvironment",demoApiKey:"demoAPIKey",demoAdditionalApiKeys:"demoAdditionalAPIKeys",demoVisitorId:"demoVisitorId",demoAccountId:"demoAccountId",demoEnv:"demoEnv",extensionApiKey:"APIKey",googleAuthUniqueId:"googleAuthUniqueId",identityProvider:"identityProvider",idpFetchedTimestamp:"idpFetchedTimestamp",idpSuccessTimestamp:"idpSuccessTimestamp",scriptSetMetadata:"scriptSetMetadata",subscriptionId:"subscriptionId",subscriptionSettings:"subscriptionSettings",visitor:"visitor",isVisitorDNP:"isVisitorDNP",visitorId:"visitorId",visitorIdPolicy:"visitorIdPolicy",initializerApiKey:"initializerApiKey",initializerVisitorId:"initializerVisitorId"};async function R(){let r=await A.getFromStorage(a.extensionApiKey),e=await A.getFromStorage(a.additionalApiKeys)||[];e=e.map(o=>{try{return JSON.parse(o)}catch{return o}});let t=[...r?[r]:[],...e];if(!t.length){let o=await g.getFromStorage(a.initializerApiKey);if(o)return[o]}return g.removeFromStorage(a.initializerApiKey),t}async function W(){let r=await g.getFromStorage(a.demoApiKey),e=await g.getFromStorage(a.demoAdditionalApiKeys)||[];return Array.isArray(e)||(e=[]),[...r?[r]:[],...e]}async function C(){let r=await R();return r.length?(g.removeFromStorage(a.demoApiKey),g.removeFromStorage(a.demoAdditionalApiKeys),r):W()}function $(){window.addEventListener("message",async r=>{if(!r||!r.data||r.data.type!=="pendo::idp-metadata-request")return;let{payload:e}=r.data,t=await C();if(t.length>0&&!t.includes(e.extensionApiKey))return;let o=await T.sendMessage("getMetadataFromProvider",e);window.postMessage({type:"pendo::idp-metadata-response",response:o},"*")})}$();})();
