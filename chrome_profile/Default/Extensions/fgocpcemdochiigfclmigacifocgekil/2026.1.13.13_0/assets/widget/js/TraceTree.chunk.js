"use strict";(window.daChatWidgetJsonpFunction=window.daChatWidgetJsonpFunction||[]).push([[894],{52560:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var n=a(73021),l=a(62771),r=a.n(l);const c=e=>e.traceTree;var o=a(7894);let s=function(e){return e.NextNode="NextNode",e.Ambiguity="Ambiguity",e.Router="Router",e.None="None",e.Interact="Interact",e.Selection="Selection",e}({});var i=a(48927);function m(e,t,a){return e===s.NextNode?"da-traceFlow__item--active":e===s.Ambiguity&&t?"da-traceFlow__item--ambiguity da-traceFlow__item--active":e===s.Ambiguity&&a?"da-traceFlow__item--ambiguity da-traceFlow__item--notSelected":e===s.Ambiguity?"da-traceFlow__item--ambiguity":e===s.Selection?"da-traceFlow__item--selection":e===s.Interact?"da-traceFlow__item--interact":e===s.None?"da-traceFlow__item--none":"da-traceFlow__item--default"}function d(e,t){return e.length>t?"".concat(e.slice(0,t),"..."):e}function _(e){var t,a;const n=null===e||void 0===e||null===(t=e.value)||void 0===t||null===(a=t[0].steps)||void 0===a?void 0:a.find(e=>e.action===i.y.IntentKnowledgeRoute);return n?{collections:n.collections||[n]}:{collections:null}}const u=()=>n.createElement("svg",{className:"da-traceFlow__svg",width:"17",height:"128",fill:"none",strokeWidth:"1"},n.createElement("path",{d:"M 0.5 0 v 54",className:"da-traceFlow__svgTopLine"}),n.createElement("path",{d:"M 12.5 45 v 30",className:"da-traceFlow__svgRightTopLine"}),n.createElement("path",{d:"M 12.5 76 v 30",className:"da-traceFlow__svgRightBottomLine"}),n.createElement("path",{d:"M 0.5 51 v 2 q 0 3 2.5 5 l 3.5 3 l 3.5 3 q 2.5 2 2.5 5 v 2",className:"da-traceFlow__svgTopWavyLine"}),n.createElement("path",{d:"M 0.5 127 v -32 q 0 -3 2.5 -5 l 3.5 -3 l 3.5 -3 q 2.5 -3 2.5 -5 v -2",className:"da-traceFlow__svgBottomWavyLine"}),n.createElement("path",{d:"M 0.5 50 v 45",className:"da-traceFlow__svgCenterLine"}),n.createElement("path",{d:"M 0.5 58 v 40",className:"da-traceFlow__svgCenterLineExpand"}),n.createElement("circle",{cx:"12.5",cy:"74",r:"4",stroke:"none",className:"da-traceFlow__svgCircle"}));let p=function(e){return e.InContext="It\u2019s in the context",e.OutContext="Out of the context",e.NeedMoreUtterances="Need more utterances for the context",e}({});const v=new Map([["In",p.InContext],["Out",p.OutContext],["NeedMore",p.NeedMoreUtterances]]),w=e=>{let{status:t,error:a}=e;const l=(0,n.useMemo)(()=>a||v.get(t),[t,a]);return n.createElement("div",{className:"da-traceFlow__node"},n.createElement("strong",{className:r()("da-traceFlow__name contextEval")},"Context Evaluation"),n.createElement("ul",{className:"da-traceFlow__list da-traceFlow__list--minimal"},n.createElement("li",{className:r()("da-traceFlow__item",{"da-traceFlow__item--contextEval":!a,"da-traceFlow__item--contextEvalError":a})},n.createElement(u,null),n.createElement("span",{className:r()("da-traceFlow__content",!a&&{"da-traceFlow__content--check":"In"===t,"da-traceFlow__content--cross":"Out"===t,"da-traceFlow__content--lamp":"NeedMore"===t})},l))))},E=e=>{let{content:t,original:a}=e;const l=d(t,250);return n.createElement("div",{className:"da-traceFlow__node"},n.createElement("strong",{className:"da-traceFlow__name promptCompletion"},"Prompt Completion"),n.createElement("ul",{className:"da-traceFlow__list da-traceFlow__list--minimal"},n.createElement("li",{className:"da-traceFlow__item da-traceFlow__item--promptCompletion"},n.createElement(u,null),n.createElement("span",{className:"da-traceFlow__content",title:l},t)),a&&n.createElement("li",{className:"da-traceFlow__item da-traceFlow__item--promptCompletion"},n.createElement("div",{className:"da-traceFlow__addition"},n.createElement("span",null,"Original utterance"),n.createElement("span",{className:"da-traceFlow__utterance"},a)))))};let F=0;const h=e=>{let{collections:t}=e;const{items:a,expandIndex:l}=(0,n.useMemo)(()=>{const e=t?[...t].sort((e,t)=>t.score-e.score):null,a=function(e){if(null!==e&&void 0!==e&&e.length){var t,a;const n=e.find(e=>e.selected),l="Ambiguity"===(null===(t=e[0])||void 0===t?void 0:t.type)&&"Ambiguity"===(null===(a=e[1])||void 0===a?void 0:a.type);if(n&&e.length>1)return 0;if(l&&e.length>2)return 1}return-1}(e);return{items:e,expandIndex:a}},[t]),c=(0,n.useMemo)(()=>"ranker".concat(F++),[]);return n.createElement("div",{className:"da-traceFlow__node"},n.createElement("strong",{className:"da-traceFlow__name ranker"},"Ranker"),n.createElement("input",{className:"da-traceTree__rankerCheckbox",type:"checkbox",id:c}),n.createElement("ul",{className:"da-traceFlow__list da-traceFlow__list--ranker"},null===a||void 0===a?void 0:a.map((e,t)=>{const o=d("Intent"===e.intentType?e.nextNodeName:e.paragraph,250);return n.createElement("li",{key:t,className:r()("da-traceFlow__rankerItem",{"da-traceFlow__rankerItem--selected":e.selected,"da-traceFlow__rankerItem--ambiguity":"Ambiguity"===e.type,"da-traceFlow__rankerItem--withExpand":l===t,"da-traceFlow__rankerItem--single":1===a.length})},n.createElement(g,null),n.createElement("span",{className:r()("da-traceFlow__content",{"da-traceFlow__content--maxRightPadding":1===e.score}),title:o},n.createElement("span",{className:"da-traceFlow__content--clamp"},"Intent"===e.intentType?e.nextNodeName:e.paragraph),n.createElement("span",{className:"da-traceFlow__label"},"Intent"===e.intentType?"Intent":"Content"),n.createElement("span",{className:"da-traceFlow__percentage"},"".concat(Math.floor(100*e.score),"%"))),l===t&&n.createElement(N,{htmlFor:c}))})))};function N(e){let{htmlFor:t}=e;return n.createElement("label",{htmlFor:t,className:"da-traceFlow__expand"},n.createElement("svg",{width:"19",height:"36",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{className:"da-traceFlow__expandTopWavyLine",d:"M.5 0v2.262a6 6 0 002.486 4.863l7.028 5.079a6 6 0 012.486 4.863V20",stroke:"#B2B2B2",strokeDasharray:"2"}),n.createElement("path",{d:"M12.5 20a6 6 0 100-12 6 6 0 000 12z",fill:"#F7F7F7",stroke:"#B2B2B2"}),n.createElement("path",{d:"M9.478 14h6",stroke:"#979797"}),n.createElement("path",{className:"da-traceFlow__expandLine",d:"M 12.478 11v6",stroke:"#979797"}),n.createElement("path",{className:"da-traceFlow__expandDashLine",d:"M12.5 22.5v15",stroke:"#B2B2B2",strokeDasharray:"2"}),n.createElement("path",{className:"da-traceFlow__expandCenterLine",d:"M 0.5 0 v29"})))}function g(){return n.createElement("svg",{className:"da-traceFlow__svg",width:"17",height:"128",fill:"none",strokeWidth:"1"},n.createElement("path",{d:"M 0.5 0 v 54",className:"da-traceFlow__svgTopLine"}),n.createElement("path",{d:"M 12.5 45 v 30",className:"da-traceFlow__svgRightTopLine"}),n.createElement("path",{d:"M 12.5 76 v 70",className:"da-traceFlow__svgRightBottomLine"}),n.createElement("path",{d:"M 0.5 51 v 2 q 0 3 2.5 5 l 3.5 3 l 3.5 3 q 2.5 2 2.5 5 v 2",className:"da-traceFlow__svgTopWavyLine"}),n.createElement("path",{d:"M 0.5 101 v -6 q 0 -3 2.5 -5 l 3.5 -3 l 3.5 -3 q 2.5 -3 2.5 -5 v -2",className:"da-traceFlow__svgBottomWavyLine"}),n.createElement("path",{d:"M 0.5 50 v 66",className:"da-traceFlow__svgCenterLine"}),n.createElement("path",{d:"M 0.5 58 v 40",className:"da-traceFlow__svgCenterLineExpand"}),n.createElement("circle",{cx:"12.5",cy:"74",r:"4",stroke:"none",className:"da-traceFlow__svgCircle"}))}const x=e=>{let{value:t}=e;const a=null==t,l=a?"\u2013\u2013":t;return n.createElement("div",{className:r()("da-knowledgeGain",{"da-knowledgeGain--disable":a})},n.createElement("span",null,"KnowledgeGain "),l)},y=e=>{let{text:t,error:a}=e;const l=(0,n.useMemo)(()=>t.length>250?"".concat(t.slice(0,250),"..."):t,[t]);return n.createElement("div",{className:"da-traceFlow__node"},n.createElement("strong",{className:r()("da-traceFlow__name rephrasing")},"Rephrasing"),n.createElement("ul",{className:"da-traceFlow__list da-traceFlow__list--minimal"},n.createElement("li",{className:r()("da-traceFlow__item",{"da-traceFlow__item--rephrasing":!a,"da-traceFlow__item--rephrasingError":a})},n.createElement(u,null),n.createElement("span",{className:"da-traceFlow__content"},n.createElement("span",{className:"da-traceFlow__content--clamp",title:l},t)))))},f=()=>{const e=(0,o.G)(c),t=(0,n.useRef)(),a=(0,n.useRef)(!1),l=(0,n.useRef)(0);(0,n.useEffect)(()=>{a.current?t.current&&e.length>l.current&&setTimeout(()=>{const e=t.current;e&&(e.scrollTop=e.scrollHeight)},500):a.current=!0,l.current=e.length},[e.length]);const s=(0,n.useMemo)(()=>function(e){let t=null;return null===e||void 0===e||e.forEach(e=>{var a;null===(a=_(e).collections)||void 0===a||a.forEach(e=>{"undefined"!==typeof e.knowledgeGain&&null!==typeof e.knowledgeGain&&(t=e.knowledgeGain)})}),t}(e),[e]);return n.createElement("div",{className:"da-traceTree"},n.createElement(x,{value:s}),n.createElement("div",{className:"da-traceFlow",ref:t},n.createElement("div",{className:"da-traceFlow__start"},n.createElement("span",null,"Start")),n.createElement("div",{className:"da-traceFlow__inner"},!!e.length&&n.createElement("div",{className:"da-traceFlow__node"},n.createElement("strong",{className:"da-traceFlow__name da-traceFlow__name--dotted"},"User utterance")),e.map((e,t)=>{const a=function(e){var t,a;const n=null===e||void 0===e||null===(t=e.value)||void 0===t||null===(a=t[0].steps)||void 0===a?void 0:a.find(e=>e.action===i.y.StandaloneQuestion);return null!==n&&void 0!==n&&n.standaloneQuestionText?{text:n.standaloneQuestionText,error:n.contextEvaluationStatus!==i.G.Success}:null}(e),l=function(e){var t,a;const n=null===e||void 0===e||null===(t=e.value)||void 0===t||null===(a=t[0].steps)||void 0===a?void 0:a.find(e=>e.action===i.y.ContextEvaluation);if(n){const e=![i.G.EmptyContext,i.G.TooShortUtterance,i.G.Success].includes(n.contextEvaluationStatus);let t=null;return e||(t=n.contextEvaluationStatus===i.G.Success?n.isFollowUp?"In":"Out":"NeedMore"),{status:t,error:e?n.contextEvaluationText:""}}return null}(e),{llmCompletionText:c}=function(e){var t,a;const n=null===e||void 0===e||null===(t=e.value)||void 0===t||null===(a=t[0].steps)||void 0===a?void 0:a.find(e=>e.action===i.y.LLMCompletion);return{llmCompletionText:(null===n||void 0===n?void 0:n.llmCompletionText)||"",llmCompletionOriginalUtterance:""}}(e),{collections:o}=_(e);return n.createElement("div",{key:t},a&&n.createElement(y,a),l&&n.createElement(w,{status:l.status,error:l.error}),(null===o||void 0===o?void 0:o.length)&&n.createElement(h,{collections:o}),c&&n.createElement(E,{content:c}),e.value&&e.value.map((t,a)=>{const l=d(t.nodeName,250);return n.createElement("div",{className:"da-traceFlow__node",key:a},n.createElement("strong",{className:r()("da-traceFlow__name",t.type),title:l},t.nodeName),n.createElement("input",{className:"da-traceFlow__checkbox",type:"checkbox",id:e.replyToId+a}),n.createElement("ul",{className:"da-traceFlow__list"},t.intentRoutes&&t.intentRoutes.map((l,c)=>{const o=1!==t.intentRoutes.length,s=0===c&&"Ambiguity"!==l.type&&o||"Ambiguity"===l.type&&1===c&&o,i=d(l.nextNodeName,250);return n.createElement("li",{key:c,className:r()("da-traceFlow__item",{"da-traceFlow__item--expand":s,"da-traceFlow__item--noMatches":1===t.intentRoutes.length},m(l.type,l.selected,l.notSelected))},n.createElement(u,null),n.createElement("span",{className:r()("da-traceFlow__content",l.type),title:i},l.nextNodeName," ",Math.floor(100*l.score),"%"),s&&n.createElement(k,{htmlFor:e.replyToId+a}))}),t.steps.filter(e=>("Selection"===e.action||"Interact"===e.action)&&("Folder"!==t.type&&"LuisFolder"!==t.type||"NotUnderstoodResult"===e.interactionType)).map((e,t)=>{const a=d(e.name,250);return n.createElement("li",{className:r()("da-traceFlow__item",e.interactionType,m(e.action,!!e.selected)),key:t},n.createElement(u,null),n.createElement("div",{className:"da-traceFlow__content da-traceFlow__content--router"},n.createElement("span",{title:a},e.name),n.createElement("strong",null,e.selected)))})))}),"end_conversation"===e.type&&n.createElement("div",{className:"da-traceFlow__end"},n.createElement("span",null,"End conversation")))}))))};function k(e){let{htmlFor:t}=e;return n.createElement("label",{htmlFor:t,className:"da-traceFlow__expand"},n.createElement("svg",{width:"19",height:"36",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M.5 0v2.262a6 6 0 002.486 4.863l7.028 5.079a6 6 0 012.486 4.863V20",stroke:"#B2B2B2",strokeDasharray:"2"}),n.createElement("path",{d:"M12.5 20a6 6 0 100-12 6 6 0 000 12z",fill:"#F7F7F7",stroke:"#B2B2B2"}),n.createElement("path",{d:"M9.478 14h6",stroke:"#979797"}),n.createElement("path",{className:"da-traceFlow__expandLine",d:"M 12.478 11v6",stroke:"#979797"}),n.createElement("path",{className:"da-traceFlow__expandDashLine",d:"M12.5 22.5v15",stroke:"#B2B2B2",strokeDasharray:"2"}),n.createElement("path",{className:"da-traceFlow__expandCenterLine",d:"M 0.5 0 v29"})))}}}]);