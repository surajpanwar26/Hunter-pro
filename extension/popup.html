<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Hunter pro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <img src="icons/icon48.png" alt="Logo" width="32" height="32">
                <div class="logo-text">
                    <h1>AI Hunter pro</h1>
                    <span class="tagline">Universal AI Job Application Assistant</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary btn-icon" id="btnToggleTopSection" title="Collapse/Expand top section" aria-label="Toggle top section">
                    ‚§¢
                </button>
                <div class="status-badge" id="statusBadge">
                    <span class="status-dot"></span>
                    <span class="status-text">Ready</span>
                </div>
            </div>
        </header>

        <!-- Portal Detection Banner -->
        <div class="portal-banner" id="portalBanner" style="display: none;">
            <span class="portal-icon">üåê</span>
            <span class="portal-name" id="portalName">Unknown Portal</span>
            <span class="portal-status" id="portalStatus">Detecting...</span>
        </div>

        <!-- Quick Actions -->
        <section class="quick-actions">
            <button class="btn btn-primary btn-large" id="btnFillForm">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
                Auto-Fill Form
            </button>
            <button class="btn btn-primary" id="btnAutoPilot" title="Run autofill then Next/Review/Submit sequence">
                ü§ñ Auto Pilot
            </button>
            <button class="btn btn-secondary" id="btnQuickSidePanel" title="Open persistent side panel mode">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <line x1="9" y1="3" x2="9" y2="21"/>
                </svg>
                Side Panel
            </button>
        </section>

        <section class="workflow-actions">
            <button class="btn btn-secondary btn-small" id="btnNextStep" title="Go to next step in application flow">
                ‚è≠ Next
            </button>
            <button class="btn btn-secondary btn-small" id="btnReviewStep" title="Open review step or scroll to review">
                üëÄ Review
            </button>
            <button class="btn btn-primary btn-small" id="btnSubmitApply" title="Submit or apply on current step">
                ‚úÖ Apply/Submit
            </button>
        </section>

        <section class="autopilot-progress" id="autopilotProgress" style="display: none;">
            <div class="autopilot-progress-header">
                <span>ü§ñ Auto Pilot Progress</span>
                <span class="autopilot-progress-phase" id="autopilotPhase">Idle</span>
            </div>
            <div class="autopilot-progress-grid">
                <div class="autopilot-progress-item">
                    <span class="autopilot-label">Step</span>
                    <span class="autopilot-value" id="autopilotStep">0/0</span>
                </div>
                <div class="autopilot-progress-item">
                    <span class="autopilot-label">Fields</span>
                    <span class="autopilot-value" id="autopilotFields">0</span>
                </div>
                <div class="autopilot-progress-item">
                    <span class="autopilot-label">Action</span>
                    <span class="autopilot-value" id="autopilotAction">Waiting</span>
                </div>
                <div class="autopilot-progress-item">
                    <span class="autopilot-label">Wait</span>
                    <span class="autopilot-value" id="autopilotWait">0s</span>
                </div>
            </div>
            <div class="autopilot-progress-note" id="autopilotNote">Ready to run.</div>
            <div class="autopilot-progress-actions">
                <button class="btn btn-secondary btn-small" id="btnAutoPilotPreview" style="display: none;">
                    üëÅÔ∏è Auto Pilot Resume Preview
                </button>
            </div>
        </section>

        <!-- JD Detection & Resume Section -->
        <section class="jd-section" id="jdSection">
            <div class="jd-header">
                <h3>üìÑ Job Description</h3>
                <div class="jd-header-buttons">
                    <button class="btn btn-small" id="btnDetectJD">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        Auto-Detect
                    </button>
                    <button class="btn btn-small btn-secondary" id="btnPasteJD">
                        üìã Paste JD
                    </button>
                    <button class="btn btn-small btn-primary" id="btnQuickTailorResume" title="Tailor resume using detected JD">
                        ‚ú® Tailor Resume
                    </button>
                </div>
            </div>
            
            <!-- Manual JD Input -->
            <div class="jd-manual-input" id="jdManualInput" style="display: none;">
                <textarea id="manualJDText" placeholder="Paste the job description here..." rows="6"></textarea>
                <div class="jd-manual-actions">
                    <button class="btn btn-primary btn-small" id="btnAnalyzeManualJD">Analyze JD</button>
                    <button class="btn btn-secondary btn-small" id="btnCancelManualJD">Cancel</button>
                </div>
            </div>
            
            <div class="jd-content" id="jdContent" style="display: none;">
                <div class="jd-preview" id="jdPreview">
                    <p class="placeholder">Click "Auto-Detect" to extract job description from page, or "Paste JD" to manually enter one</p>
                </div>

                <div class="jd-structured" id="jdStructured" style="display: none;">
                    <div class="structured-grid">
                        <div class="structured-card">
                            <h5>üíº Role</h5>
                            <p id="jdRole" class="structured-value">‚Äî</p>
                        </div>
                        <div class="structured-card">
                            <h5>üõÇ Visa Sponsorship</h5>
                            <p id="jdVisa" class="structured-value">‚Äî</p>
                        </div>
                        <div class="structured-card">
                            <h5>üí∞ Salary</h5>
                            <p id="jdSalary" class="structured-value">‚Äî</p>
                        </div>
                    </div>
                </div>

                <div class="jd-skills" id="jdSkills" style="display: none;">
                    <h4>Required Skills</h4>
                    <div class="skill-tags" id="skillTags"></div>
                </div>
                
                <!-- Master Resume Selection -->
                <div class="resume-source" id="resumeSource" style="display: none;">
                    <h4>üìÅ Resume Source</h4>
                    <div class="resume-options">
                        <label class="resume-option">
                            <input type="radio" name="resumeSource" value="master" checked>
                            <span>Master Resume (from project)</span>
                        </label>
                        <label class="resume-option">
                            <input type="radio" name="resumeSource" value="upload">
                            <span>Upload Resume</span>
                        </label>
                    </div>
                    <div class="resume-upload" id="resumeUpload" style="display: none;">
                        <input type="file" id="masterResumeFile" accept=".pdf,.docx">
                        <small>Supported: PDF, DOCX</small>
                    </div>
                    <div class="master-resume-info" id="masterResumeInfo">
                        <small>üìÑ Using project master resume</small>
                    </div>
                </div>

                <div class="structured-section" id="instructionBox" style="display: none;">
                    <div class="jd-title-row">
                        <h5>üß† Instructions</h5>
                        <button class="btn btn-small btn-secondary" id="btnShowInstructions">Show Instructions</button>
                    </div>
                    <div id="instructionContent" style="display: none;">
                        <div class="jd-title-row">
                            <h5>Tailoring Instructions</h5>
                            <button class="btn btn-small btn-secondary" id="btnGiveInstruction">Give Instruction</button>
                        </div>
                        <textarea id="tailoringInstruction" rows="10" placeholder="Instruction will be prefilled from project defaults"></textarea>
                        <h5 class="instruction-subtitle">Reviewer Agent Instructions</h5>
                        <textarea id="reviewerInstruction" rows="8" readonly placeholder="Reviewer guidance will load from API defaults"></textarea>
                    </div>
                </div>
                
                <div class="jd-actions" id="jdActions" style="display: none;">
                    <button class="btn btn-primary" id="btnTailorResume">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        Generate Tailored Resume
                    </button>
                    <button class="btn btn-secondary" id="btnReviewResume" style="display: none;">
                        üîç Review with AI
                    </button>
                </div>
                <p class="review-gate-note" id="reviewGateNote" style="display: none;">Run AI Review before Preview/Download/Use.</p>
                <div class="tailor-failure-actions" id="tailorFailureActions" style="display: none; margin-top: 8px;">
                    <div class="button-group">
                        <button class="btn btn-secondary" id="btnRetryTailorGuided">Retry (with guidance)</button>
                        <button class="btn btn-secondary" id="btnOpenManualEditor">Open manual editor</button>
                        <button class="btn btn-secondary" id="btnDownloadCurrentDraft">Download tailored draft</button>
                        <button class="btn btn-secondary" id="btnSendHumanReview">Send to human reviewer</button>
                    </div>
                </div>
                
                <!-- AI Review Status -->
                <div class="ai-review-status" id="aiReviewStatus" style="display: none;">
                    <div class="review-progress">
                        <span class="review-icon">ü§ñ</span>
                        <span class="review-text" id="reviewText">AI Reviewer analyzing...</span>
                    </div>
                    <div class="review-iterations" id="reviewIterations">
                        Iteration: <span id="iterationCount">0</span>/3
                    </div>
                </div>
            </div>
        </section>

        <!-- ATS Score Display -->
        <section class="ats-section" id="atsSection" style="display: none;">
            <div class="ats-scores">
                <div class="score-card ats-score">
                    <div class="score-ring">
                        <svg viewBox="0 0 36 36">
                            <path class="score-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            <path class="score-fill" id="atsScoreRing" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                        </svg>
                        <span class="score-value" id="atsScoreValue">--</span>
                    </div>
                    <span class="score-label">ATS Score</span>
                </div>
                <div class="score-card match-score">
                    <div class="score-ring">
                        <svg viewBox="0 0 36 36">
                            <path class="score-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            <path class="score-fill" id="matchScoreRing" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                        </svg>
                        <span class="score-value" id="matchScoreValue">--</span>
                    </div>
                    <span class="score-label">Job Match</span>
                </div>
            </div>
            <div class="resume-actions" id="resumeActions" style="display: none;">
                <button class="btn btn-secondary" id="btnPreviewResume">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    Preview
                </button>
                <button class="btn btn-secondary" id="btnDownloadDocx">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                        <polyline points="7,10 12,15 17,10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    DOCX
                </button>
                <button class="btn btn-secondary" id="btnDownloadPdf">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                    </svg>
                    PDF
                </button>
                <button class="btn btn-secondary" id="btnOpenDocx">
                    Open DOCX
                </button>
                <button class="btn btn-secondary" id="btnOpenPdf">
                    Open PDF
                </button>
            </div>
        </section>

        <!-- Tabs -->
        <nav class="tabs">
            <button class="tab active" data-tab="profile">Profile</button>
            <button class="tab" data-tab="settings">Settings</button>
            <button class="tab" data-tab="learning">Learning</button>
            <button class="tab" data-tab="history">History</button>
        </nav>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Profile Tab -->
            <div class="tab-panel active" id="profile">
                <div class="form-section" id="unknownFieldsHomeSection" style="display: none;">
                    <h3>üß© Action Needed: Unfilled Fields</h3>
                    <p class="section-desc">Autofill paused on these questions. Add answers once, save, and the extension reuses them next time.</p>
                    <div class="unknown-fields-help">
                        <span>1) Pick a detected option or type your answer</span>
                        <span>2) Click save to learn and refill</span>
                    </div>
                    <div id="unknownFieldsHomeSummary" class="unknown-fields-summary"></div>
                    <div id="unknownFieldsHomeList" class="unknown-fields-list"></div>
                    <button class="btn btn-primary full-width" id="btnSaveUnknownAnswersHome" style="margin-top: 10px;">
                        Save Answers & Re-Fill Current Form
                    </button>
                </div>

                <form id="profileForm">
                    <!-- Personal Info -->
                    <div class="form-section">
                        <h3>Personal Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="firstName">First Name</label>
                                <input type="text" id="firstName" placeholder="John">
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name</label>
                                <input type="text" id="lastName" placeholder="Doe">
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" placeholder="john@example.com">
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone</label>
                                <input type="tel" id="phone" placeholder="+1 234 567 8900">
                            </div>
                            <div class="form-group">
                                <label for="currentCity">Current City</label>
                                <input type="text" id="currentCity" placeholder="San Francisco, CA">
                            </div>
                        </div>
                    </div>

                    <!-- Work Info -->
                    <div class="form-section">
                        <h3>Work Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="currentCompany">Current Company</label>
                                <input type="text" id="currentCompany" placeholder="Acme Inc.">
                            </div>
                            <div class="form-group">
                                <label for="currentTitle">Current Title</label>
                                <input type="text" id="currentTitle" placeholder="Software Engineer">
                            </div>
                            <div class="form-group">
                                <label for="yearsExperience">Years of Experience</label>
                                <input type="number" id="yearsExperience" placeholder="5" min="0" max="50">
                            </div>
                            <div class="form-group">
                                <label for="expectedSalary">Expected Salary</label>
                                <input type="text" id="expectedSalary" placeholder="150000">
                            </div>
                            <div class="form-group">
                                <label for="noticePeriod">Notice Period</label>
                                <input type="text" id="noticePeriod" placeholder="2 weeks">
                            </div>
                        </div>
                    </div>

                    <!-- Links -->
                    <div class="form-section">
                        <h3>Profile Links</h3>
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="linkedinUrl">LinkedIn URL</label>
                                <input type="url" id="linkedinUrl" placeholder="https://linkedin.com/in/johndoe">
                            </div>
                            <div class="form-group">
                                <label for="portfolioUrl">Portfolio</label>
                                <input type="url" id="portfolioUrl" placeholder="https://johndoe.com">
                            </div>
                            <div class="form-group">
                                <label for="githubUrl">GitHub</label>
                                <input type="url" id="githubUrl" placeholder="https://github.com/johndoe">
                            </div>
                        </div>
                    </div>

                    <!-- Common Questions -->
                    <div class="form-section">
                        <h3>Common Questions</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="workAuthorization">Work Authorization</label>
                                <select id="workAuthorization">
                                    <option value="yes">Yes - Authorized</option>
                                    <option value="no">No - Not Authorized</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="sponsorship">Need Sponsorship?</label>
                                <select id="sponsorship">
                                    <option value="no">No</option>
                                    <option value="yes">Yes</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="remoteWork">Open to Remote?</label>
                                <select id="remoteWork">
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="willingToRelocate">Willing to Relocate?</label>
                                <select id="willingToRelocate">
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Education -->
                    <div class="form-section">
                        <h3>Education</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="degree">Degree</label>
                                <input type="text" id="degree" placeholder="Bachelor's">
                            </div>
                            <div class="form-group">
                                <label for="major">Major</label>
                                <input type="text" id="major" placeholder="Computer Science">
                            </div>
                            <div class="form-group">
                                <label for="school">School</label>
                                <input type="text" id="school" placeholder="MIT">
                            </div>
                            <div class="form-group">
                                <label for="graduationYear">Graduation Year</label>
                                <input type="number" id="graduationYear" placeholder="2020" min="1950" max="2030">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary full-width">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                            <polyline points="17,21 17,13 7,13 7,21"/>
                            <polyline points="7,3 7,8 15,8"/>
                        </svg>
                        Save Profile
                    </button>
                    
                    <div class="import-section" style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e5e5e5;">
                        <p style="font-size: 11px; color: #666; margin-bottom: 8px; text-align: center;">
                            üìÅ Import profile from config file (run config_loader.py first)
                        </p>
                        <input type="file" id="importConfig" accept=".json" style="display: none;">
                        <button type="button" class="btn btn-secondary full-width" id="btnImportConfig">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                <polyline points="17,8 12,3 7,8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            Import from Config File
                        </button>
                    </div>
                </form>
            </div>

            <!-- Settings Tab -->
            <div class="tab-panel" id="settings">
                <div class="form-section">
                    <h3>Auto-Fill Settings</h3>
                    <div class="settings-list">
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Auto-detect Easy Apply</span>
                                <span class="setting-desc">Automatically detect when Easy Apply modal opens</span>
                            </div>
                            <label class="switch" for="autoDetect">
                                <input type="checkbox" id="autoDetect" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Auto-fill on Detection</span>
                                <span class="setting-desc">Automatically fill forms when detected</span>
                            </div>
                            <label class="switch" for="autoFill">
                                <input type="checkbox" id="autoFill">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Show Notifications</span>
                                <span class="setting-desc">Show desktop notifications on fill complete</span>
                            </div>
                            <label class="switch" for="showNotifications">
                                <input type="checkbox" id="showNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Debug Mode</span>
                                <span class="setting-desc">Enable console logging for troubleshooting</span>
                            </div>
                            <label class="switch" for="debugMode">
                                <input type="checkbox" id="debugMode">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Use Side Panel Mode</span>
                                <span class="setting-desc">Keep extension open side-by-side while working on forms</span>
                            </div>
                            <label class="switch" for="useSidePanelMode">
                                <input type="checkbox" id="useSidePanelMode">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Side Panel</h3>
                    <p class="section-desc">Popup windows close when focus moves outside (browser behavior). Use side panel for persistent workflow.</p>
                    <button class="btn btn-primary full-width" id="btnOpenSidePanel">
                        Open Side Panel Now
                    </button>
                </div>

                <div class="form-section">
                    <h3>Privacy & Diagnostics</h3>
                    <p class="section-desc">Control telemetry, inspect what is stored locally, export personal data, or clear all personal data.</p>
                    <div class="settings-list">
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Telemetry Opt-In</span>
                                <span class="setting-desc">Disabled by default. When enabled, only anonymized diagnostic events are stored locally.</span>
                            </div>
                            <label class="switch" for="telemetryOptIn">
                                <input type="checkbox" id="telemetryOptIn">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="privacy-summary" id="privacyDataSummary">
                        <small>Loading stored data summary...</small>
                    </div>
                    <div class="button-group" style="margin-top: 10px;">
                        <button class="btn btn-secondary" id="btnExportPersonalData">Export Personal Data</button>
                        <button class="btn btn-secondary" id="btnSendDiagnostics">Send Diagnostic Log</button>
                        <button class="btn btn-secondary" id="btnClearPersonalData">Clear All Personal Data</button>
                    </div>
                </div>

                <div class="form-section">
                    <h3>API Health</h3>
                    <p class="section-desc">If local API is offline, extension uses degraded fallback for preview and scoring.</p>
                    <div id="apiHealthStatus" class="privacy-summary"><small>Checking API status...</small></div>
                    <div class="settings-list" style="margin-top: 10px;">
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Auto Pilot API Backup Mode</span>
                                <span class="setting-desc">If tailoring API is unavailable, continue Auto Pilot without tailored resume upload as a backup path.</span>
                            </div>
                            <label class="switch" for="autopilotApiBackupOnOffline">
                                <input type="checkbox" id="autopilotApiBackupOnOffline">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Fill Behavior</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fillDelay">Fill Delay (ms)</label>
                            <input type="number" id="fillDelay" value="100" min="0" max="1000">
                        </div>
                        <div class="form-group">
                            <label for="maxRetries">Max Retries</label>
                            <input type="number" id="maxRetries" value="3" min="1" max="10">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Resume Upload Source</h3>
                    <p class="section-desc">Used when application forms ask for a resume file. Default: Tailored Resume.</p>
                    <div class="resume-options" id="autofillResumeOptions">
                        <label class="resume-option">
                            <input type="radio" name="autofillResumeSource" value="tailored" checked>
                            <span>Tailored Resume (latest generated)</span>
                        </label>
                        <label class="resume-option">
                            <input type="radio" name="autofillResumeSource" value="master">
                            <span>Master Resume</span>
                        </label>
                        <label class="resume-option">
                            <input type="radio" name="autofillResumeSource" value="upload">
                            <span>Upload Local Resume</span>
                        </label>
                    </div>
                    <div class="resume-upload" id="autofillResumeUpload" style="display: none; margin-top: 8px;">
                        <input type="file" id="autofillResumeFile" accept=".pdf,.docx">
                        <small>Supported: PDF, DOCX</small>
                    </div>
                    <div class="master-resume-info" id="autofillResumeInfo" style="margin-top: 6px;">
                        <small>Default source: Tailored Resume</small>
                    </div>
                    <div class="resume-upload-format" style="margin-top: 10px;">
                        <label for="autofillResumeFormat">Upload Format</label>
                        <select id="autofillResumeFormat">
                            <option value="pdf" selected>PDF (default)</option>
                            <option value="docx">DOCX</option>
                        </select>
                        <small>Auto-fill upload will always use this format (never TXT).</small>
                    </div>
                    <div class="settings-list" style="margin-top: 10px;">
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Preview Resume Before Upload</span>
                                <span class="setting-desc">Show ATS/Match and highlighted changes before form upload</span>
                            </div>
                            <label class="switch" for="previewBeforeUpload">
                                <input type="checkbox" id="previewBeforeUpload" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Auto Pilot Tailoring Mode</h3>
                    <p class="section-desc">Controls how AI generates tailored resume content during Auto Pilot.</p>
                    <div class="resume-options" id="autopilotTailorModeOptions">
                        <label class="resume-option">
                            <input type="radio" name="autopilotTailorMode" value="master_preserve" checked>
                            <span>Master-Based (strictly preserve format/sections)</span>
                        </label>
                        <label class="resume-option">
                            <input type="radio" name="autopilotTailorMode" value="scratch">
                            <span>From Scratch (optimize aggressively to JD)</span>
                        </label>
                    </div>
                    <div class="master-resume-info" id="autopilotTailorModeInfo" style="margin-top: 6px;">
                        <small>Current mode: Master-Based (strict preserve)</small>
                    </div>
                </div>

                <button class="btn btn-secondary full-width" id="btnResetSettings">
                    Reset to Defaults
                </button>
                
                <button class="btn btn-primary full-width" id="btnRefreshFromConfig" style="margin-top: 10px; background: linear-gradient(135deg, #10b981, #059669);">
                    üîÑ Refresh from Project Config
                </button>
                <p style="font-size: 11px; color: #6b7280; text-align: center; margin-top: 5px;">
                    Clears storage and reloads from user_config.json
                </p>
            </div>

            <!-- History Tab -->
            <div class="tab-panel" id="history">
                <div class="history-stats">
                    <div class="stat-card">
                        <span class="stat-value" id="totalFilled">0</span>
                        <span class="stat-label">Forms Filled</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="fieldsFilled">0</span>
                        <span class="stat-label">Fields Filled</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="timeSaved">0</span>
                        <span class="stat-label">Minutes Saved</span>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Recent Activity</h3>
                    <div id="historyList" class="history-list">
                        <div class="empty-state">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12,6 12,12 16,14"/>
                            </svg>
                            <p>No activity yet</p>
                            <span>Start filling forms to see your history</span>
                        </div>
                    </div>
                </div>

                <button class="btn btn-secondary full-width" id="btnClearHistory">
                    Clear History
                </button>
            </div>

            <!-- Learning Tab (NEW) -->
            <div class="tab-panel" id="learning">
                <div class="form-section">
                    <h3>üß† AI Learning</h3>
                    <p class="section-desc">The extension learns from your inputs to better fill forms in the future.</p>
                    
                    <div class="learning-stats">
                        <div class="stat-item">
                            <span class="stat-icon">üìö</span>
                            <span class="stat-info">
                                <span class="stat-value" id="learnedFieldsCount">0</span>
                                <span class="stat-label">Learned Fields</span>
                            </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üåê</span>
                            <span class="stat-info">
                                <span class="stat-value" id="portalsUsed">0</span>
                                <span class="stat-label">Portals Used</span>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Learned Field Mappings</h3>
                    <div id="learnedFieldsList" class="learned-fields-list">
                        <div class="empty-state">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/>
                                <path d="M8.5 8.5v.01"/>
                                <path d="M16 15.5v.01"/>
                                <path d="M12 12v.01"/>
                            </svg>
                            <p>No learned fields yet</p>
                            <span>Fill forms manually to teach the AI</span>
                        </div>
                    </div>
                </div>

                <div class="form-section" id="unknownFieldsSection" style="display: none;">
                    <h3>üß© Action Needed: Unfilled Fields</h3>
                    <p class="section-desc">These fields were not auto-filled. Save answers here so similar fields are handled automatically next time.</p>
                    <div class="unknown-fields-help">
                        <span>1) Select from options (if shown) or type an answer</span>
                        <span>2) Save to train autofill for this field pattern</span>
                    </div>
                    <div id="unknownFieldsSummary" class="unknown-fields-summary"></div>
                    <div id="unknownFieldsList" class="unknown-fields-list"></div>
                    <button class="btn btn-primary full-width" id="btnSaveUnknownAnswers" style="margin-top: 10px;">
                        Save Answers for Future Autofill
                    </button>
                </div>

                <div class="form-section">
                    <h3>Settings</h3>
                    <div class="settings-list">
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Enable AI Learning</span>
                                <span class="setting-desc">Learn from your manual form inputs</span>
                            </div>
                            <label class="switch" for="enableLearning">
                                <input type="checkbox" id="enableLearning" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Sync to Python Config</span>
                                <span class="setting-desc">Save learned fields to project config</span>
                            </div>
                            <label class="switch" for="syncToConfig">
                                <input type="checkbox" id="syncToConfig" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" id="btnExportLearned">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Export
                    </button>
                    <button class="btn btn-secondary" id="btnClearLearned">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3,6 5,6 21,6"/>
                            <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                        </svg>
                        Clear All
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <span>Universal Job AutoFill Pro v3.0</span>
            <a href="#" id="helpLink">Help</a>
        </footer>
    </div>

    <!-- Analysis Modal -->
    <div class="modal" id="analysisModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Form Analysis</h2>
                <button class="modal-close" id="closeAnalysis">&times;</button>
            </div>
            <div class="modal-body" id="analysisContent">
                <!-- Analysis results will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Resume Preview Modal -->
    <div class="modal" id="resumeModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üìÑ Tailored Resume Preview</h2>
                <button class="modal-close" id="closeResume">&times;</button>
            </div>
            <div class="modal-body" id="resumeContent">
                <!-- Resume preview will be inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="btnModalDownloadDocx">Download DOCX</button>
                <button class="btn btn-secondary" id="btnModalDownloadPdf">Download PDF</button>
                <button class="btn btn-secondary" id="btnModalOpenDocx">Open DOCX</button>
                <button class="btn btn-secondary" id="btnModalOpenPdf">Open PDF</button>
                <button class="btn btn-primary" id="btnUseResume">Use This Resume</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span class="toast-message"></span>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text" id="loadingText">Processing...</p>
            <div class="loading-progress" id="loadingProgress" style="display: none;">
                <div class="loading-progress-track">
                    <div class="loading-progress-bar" id="loadingProgressBar"></div>
                </div>
                <p class="loading-progress-text" id="loadingProgressText">0%</p>
            </div>
        </div>
    </div>

    <script src="resume_engine.js"></script>
    <script src="popup_helpers.js"></script>
    <script src="popup.js"></script>
</body>
</html>
