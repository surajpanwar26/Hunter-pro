<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hunter Pro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app">
        <!-- ====== SIDEBAR RAIL ====== -->
        <nav class="sidebar">
            <div class="sidebar-logo">H</div>
            <button class="nav-btn active" data-panel="home" title="Dashboard">üè†</button>
            <button class="nav-btn" id="sidebarDetect" title="Detect JD">üîç</button>
            <button class="nav-btn" id="sidebarResume" title="Resume">üìÑ</button>
            <button class="nav-btn" data-panel="settings" title="Settings">‚öôÔ∏è</button>
            <button class="nav-btn" data-panel="learning" title="Learning">üß†</button>
            <button class="nav-btn" data-panel="history" title="History">üìä</button>
            <div class="sidebar-spacer"></div>
            <button class="nav-btn" id="helpLink" title="Help">‚ùì</button>
        </nav>

        <!-- ====== MAIN CONTENT ====== -->
        <main class="content">

            <!-- ====== HOME PANEL ====== -->
            <div class="panel active" id="home">

                <!-- Status Badge (hidden, used by JS) -->
                <div class="status-badge" id="statusBadge" style="display:none;">
                    <span class="status-dot"></span>
                    <span class="status-text">Ready</span>
                </div>

                <!-- Autopilot Bar -->
                <div class="autopilot-bar" id="autopilotBar">
                    <span class="ap-label">AUTOPILOT</span>
                    <label class="ap-toggle">
                        <input type="checkbox" id="autopilotToggle">
                        <span class="ap-slider"></span>
                    </label>
                    <span class="ap-status" id="apStatus">OFF</span>
                </div>

                <!-- Stats Row -->
                <div class="stats-row">
                    <div class="stat"><div class="stat-num stat-green" id="statApplied">0</div><div class="stat-lbl">Applied</div></div>
                    <div class="stat"><div class="stat-num stat-yellow" id="statQueue">0</div><div class="stat-lbl">Queue</div></div>
                    <div class="stat"><div class="stat-num stat-red" id="statFailed">0</div><div class="stat-lbl">Fails</div></div>
                    <div class="stat"><div class="stat-num stat-blue" id="statRate">--%</div><div class="stat-lbl">Rate</div></div>
                </div>

                <!-- Portal Detection Banner -->
                <div class="portal-banner" id="portalBanner" style="display:none;">
                    <span class="portal-icon">üåê</span>
                    <span class="portal-name" id="portalName">Unknown Portal</span>
                    <span class="portal-status" id="portalStatus">Detecting...</span>
                </div>

                <!-- JD Intelligence Card -->
                <div class="jd-card">
                    <div class="jd-card-header">
                        <h4>JOB INTELLIGENCE</h4>
                        <div class="jd-btns">
                            <button class="btn-sm" id="btnDetectJD">üîç Detect</button>
                            <button class="btn-sm" id="btnPasteJD">üìã Paste</button>
                        </div>
                    </div>

                    <!-- Manual JD Input -->
                    <div class="jd-manual" id="jdManualInput" style="display:none;">
                        <textarea id="manualJDText" placeholder="Paste job description here..." rows="5"></textarea>
                        <div class="jd-manual-actions">
                            <button class="btn-pri btn-sm" id="btnAnalyzeManualJD">Analyze</button>
                            <button class="btn-sec btn-sm" id="btnCancelManualJD">Cancel</button>
                        </div>
                    </div>

                    <!-- Structured JD Display -->
                    <div class="jd-structured" id="jdContent" style="display:none;">
                        <div class="company-row">
                            <div class="company-avatar" id="companyAvatar">?</div>
                            <div class="company-info">
                                <h3 id="companyName">Company</h3>
                                <p id="jobRole">Role</p>
                            </div>
                        </div>
                        <div class="meta-grid" id="metaGrid"></div>
                        <div class="jd-skills" id="jdSkills" style="display:none;">
                            <div class="skill-tags" id="skillTags"></div>
                        </div>
                    </div>

                    <!-- JD Preview (for raw text fallback) -->
                    <div id="jdPreview" style="display:none;"></div>

                    <!-- Placeholder -->
                    <div class="jd-placeholder" id="jdPlaceholder">
                        <p>Click <strong>"Detect"</strong> to extract job info from page</p>
                    </div>
                </div>

                <!-- Score Badges -->
                <div class="scores-row" id="atsSection" style="display:none;">
                    <div class="score-badge">
                        <div class="score-val ats" id="atsScoreValue">--</div>
                        <div class="score-lbl">ATS Score</div>
                    </div>
                    <div class="score-badge">
                        <div class="score-val match" id="matchScoreValue">--</div>
                        <div class="score-lbl">Job Match</div>
                    </div>
                </div>

                <!-- Resume Source -->
                <div class="resume-source" id="resumeSource" style="display:none;">
                    <h4>üìÅ Resume Source</h4>
                    <div class="resume-options">
                        <label class="resume-option">
                            <input type="radio" name="resumeSource" value="master" checked>
                            <span>Master Resume</span>
                        </label>
                        <label class="resume-option">
                            <input type="radio" name="resumeSource" value="upload">
                            <span>Upload Resume</span>
                        </label>
                    </div>
                    <div class="resume-upload" id="resumeUpload" style="display:none;">
                        <input type="file" id="masterResumeFile" accept=".pdf,.docx,.txt">
                        <small>PDF, DOCX, TXT</small>
                    </div>
                    <div class="master-resume-info" id="masterResumeInfo">
                        <small>üìÑ Using: master resume/resume.txt</small>
                    </div>
                </div>

                <!-- JD Actions -->
                <div class="jd-actions" id="jdActions" style="display:none;">
                    <button class="btn-pri" id="btnTailorResume">üìÑ Tailor Resume</button>
                    <button class="btn-sec" id="btnReviewResume" style="display:none;">üîç Review</button>
                </div>

                <!-- AI Review Status -->
                <div class="ai-review" id="aiReviewStatus" style="display:none;">
                    <div class="review-progress">
                        <span class="review-icon">ü§ñ</span>
                        <span class="review-text" id="reviewText">AI analyzing...</span>
                    </div>
                    <div class="review-iterations">
                        Iteration: <span id="iterationCount">0</span>/3
                    </div>
                </div>

                <!-- Resume Actions -->
                <div class="resume-actions-row" id="resumeActions" style="display:none;">
                    <button class="btn-sec btn-sm" id="btnPreviewResume">üëÅ Preview</button>
                    <button class="btn-sec btn-sm" id="btnDownloadDocx">üì• DOCX</button>
                    <button class="btn-sec btn-sm" id="btnDownloadPdf">üì• PDF</button>
                </div>

                <!-- Main Action Buttons -->
                <div class="actions-row">
                    <button class="btn-pri" id="btnFillForm">‚ú® Auto-Fill</button>
                    <button class="btn-sec" id="btnAnalyze">üî¨</button>
                </div>
            </div>

            <!-- ====== SETTINGS PANEL ====== -->
            <div class="panel" id="settings">
                <div class="panel-title">‚öôÔ∏è Settings</div>
                <div class="form-section">
                    <h3>Auto-Fill Settings</h3>
                    <div class="settings-list">
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Auto-detect Easy Apply</span>
                                <span class="setting-desc">Detect when Easy Apply modal opens</span>
                            </div>
                            <label class="switch" for="autoDetect">
                                <input type="checkbox" id="autoDetect" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Auto-fill on Detection</span>
                                <span class="setting-desc">Automatically fill when detected</span>
                            </div>
                            <label class="switch" for="autoFill">
                                <input type="checkbox" id="autoFill">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Show Notifications</span>
                                <span class="setting-desc">Desktop notifications on fill</span>
                            </div>
                            <label class="switch" for="showNotifications">
                                <input type="checkbox" id="showNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Debug Mode</span>
                                <span class="setting-desc">Console logging for troubleshooting</span>
                            </div>
                            <label class="switch" for="debugMode">
                                <input type="checkbox" id="debugMode">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-section">
                    <h3>Fill Behavior</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fillDelay">Fill Delay (ms)</label>
                            <input type="number" id="fillDelay" value="100" min="0" max="1000">
                        </div>
                        <div class="form-group">
                            <label for="maxRetries">Max Retries</label>
                            <input type="number" id="maxRetries" value="3" min="1" max="10">
                        </div>
                    </div>
                </div>
                <button class="btn-sec full-width" id="btnResetSettings">Reset to Defaults</button>
                <button class="btn-pri full-width" id="btnRefreshFromConfig" style="margin-top:8px;">üîÑ Refresh from Config</button>
                <p class="hint-text">Clears storage and reloads from user_config.json</p>
            </div>

            <!-- ====== LEARNING PANEL ====== -->
            <div class="panel" id="learning">
                <div class="panel-title">üß† Learning</div>
                <div class="learning-overview">
                    <div class="learning-card learning-card-primary">
                        <div class="learning-card-icon">üß†</div>
                        <div class="learning-card-data">
                            <span class="learning-card-value" id="learnedFieldsCount">0</span>
                            <span class="learning-card-label">Learned</span>
                        </div>
                    </div>
                    <div class="learning-card">
                        <div class="learning-card-icon">üåê</div>
                        <div class="learning-card-data">
                            <span class="learning-card-value" id="portalsUsed">0</span>
                            <span class="learning-card-label">Portals</span>
                        </div>
                    </div>
                    <div class="learning-card">
                        <div class="learning-card-icon">üéØ</div>
                        <div class="learning-card-data">
                            <span class="learning-card-value" id="learnedAccuracy">--</span>
                            <span class="learning-card-label">Accuracy</span>
                        </div>
                    </div>
                </div>
                <div class="learning-toolbar">
                    <div class="learning-search">
                        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                        <input type="text" id="learnedSearchInput" placeholder="Search fields..." class="learning-search-input">
                    </div>
                    <div class="learning-filter-chips">
                        <button class="filter-chip active" data-filter="all">All</button>
                        <button class="filter-chip" data-filter="text">Text</button>
                        <button class="filter-chip" data-filter="select">Select</button>
                        <button class="filter-chip" data-filter="radio">Radio</button>
                        <button class="filter-chip" data-filter="textarea">Textarea</button>
                        <button class="filter-chip" data-filter="checkbox">Checkbox</button>
                    </div>
                </div>
                <div id="learnedFieldsList" class="learned-fields-list">
                    <div class="empty-state">
                        <p>No learned fields yet</p>
                        <span>Fill forms manually and the AI will learn</span>
                    </div>
                </div>
                <div class="form-section learning-settings-section">
                    <h3>Settings</h3>
                    <div class="settings-list">
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Enable AI Learning</span>
                                <span class="setting-desc">Learn from manual inputs</span>
                            </div>
                            <label class="switch" for="enableLearning">
                                <input type="checkbox" id="enableLearning" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <span class="setting-label">Sync to Backend</span>
                                <span class="setting-desc">Sync learned fields with bot</span>
                            </div>
                            <label class="switch" for="syncToConfig">
                                <input type="checkbox" id="syncToConfig" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="learning-actions">
                    <button class="btn-sec" id="btnImportLearned" title="Import">üì• Import</button>
                    <button class="btn-sec" id="btnExportLearned" title="Export">üì§ Export</button>
                    <button class="btn-danger" id="btnClearLearned" title="Clear All">üóë Clear</button>
                </div>
                <input type="file" id="learnedImportFile" accept=".json" style="display:none">
            </div>

            <!-- ====== HISTORY PANEL ====== -->
            <div class="panel" id="history">
                <div class="panel-title">üìä History</div>
                <div class="history-stats">
                    <div class="stat-card">
                        <span class="stat-value" id="totalFilled">0</span>
                        <span class="stat-label">Forms</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="fieldsFilled">0</span>
                        <span class="stat-label">Fields</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="timeSaved">0</span>
                        <span class="stat-label">Min Saved</span>
                    </div>
                </div>
                <div class="form-section">
                    <h3>Recent Activity</h3>
                    <div id="historyList" class="history-list">
                        <div class="empty-state">
                            <p>No activity yet</p>
                            <span>Start filling forms to see history</span>
                        </div>
                    </div>
                </div>
                <button class="btn-sec full-width" id="btnClearHistory">Clear History</button>
            </div>
        </main>
    </div>

    <!-- ====== ANALYSIS MODAL ====== -->
    <div class="modal" id="analysisModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Form Analysis</h2>
                <button class="modal-close" id="closeAnalysis">&times;</button>
            </div>
            <div class="modal-body" id="analysisContent"></div>
        </div>
    </div>

    <!-- ====== RESUME PREVIEW MODAL ====== -->
    <div class="modal" id="resumeModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üìÑ Tailored Resume</h2>
                <button class="modal-close" id="closeResume">&times;</button>
            </div>
            <div class="modal-body" id="resumeContent"></div>
            <div class="modal-footer">
                <button class="btn-sec" id="btnModalDownloadDocx">DOCX</button>
                <button class="btn-sec" id="btnModalDownloadPdf">PDF</button>
                <button class="btn-pri" id="btnUseResume">Use This Resume</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"><span class="toast-message"></span></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display:none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text" id="loadingText">Processing...</p>
        </div>
    </div>

    <script src="resume_engine.js"></script>
    <script src="popup.js"></script>
</body>
</html>
